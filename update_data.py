# update_data.py
import subprocess
import sys
import os

# ูุณุช ุงุฒ ุงุณฺฉุฑูพุชโูุง ฺฉู ุจุงุฏ ุจู ุชุฑุชุจ ุงุฌุฑุง ุดููุฏ
SCRIPTS_IN_ORDER = [
    "usnews_scraper.py",      # ฑ. ุงุณุชุฎุฑุงุฌ ูุณุช ุงููู ุฏุงูุดฺฏุงูโูุง
    "deadline_scraper.py",    # ฒ. ุงุณุชุฎุฑุงุฌ ุงุทูุงุนุงุช ุฏุฏูุงูโูุง
    "identify_failures.py",   # ณ. ุฌุฏุงุณุงุฒ ููุงุฑุฏ ูููู ู ูุงูููู
    "web_scraper.py",         # ด. ุงุณุชุฎุฑุงุฌ ูุณุช ุงุณุงุชุฏ
    "merge_data.py",          # ต. ุงุฏุบุงู ุชูุงู ุฏุงุฏูโูุง ู ุณุงุฎุช ูุงู ููุง
]

def run_script(script_name):
    """ฺฉ ุงุณฺฉุฑูพุช ูพุงุชูู ุฑุง ุงุฌุฑุง ฺฉุฑุฏู ู ููุชุธุฑ ุงุชูุงู ุขู ูโูุงูุฏ."""
    
    # ุงุทููุงู ุงุฒ ูุฌูุฏ ูุงู ุงุณฺฉุฑูพุช
    if not os.path.exists(script_name):
        print(f"โ ุฎุทุง: ูุงู ุงุณฺฉุฑูพุช '{script_name}' ูพุฏุง ูุดุฏ. ุงุฌุฑุง ูุชููู ุดุฏ.")
        return False

    # ุงุณุชูุงุฏู ุงุฒ ููุงู ููุณุฑ ูพุงุชูู ฺฉู ุงู ุงุณฺฉุฑูพุช ุฑุง ุงุฌุฑุง ูโฺฉูุฏ
    python_executable = sys.executable
    
    print("-" * 60)
    print(f"๐ ุฏุฑ ุญุงู ุงุฌุฑุง ุงุณฺฉุฑูพุช: {script_name}")
    print("-" * 60)
    
    # ุงุฌุฑุง ฺฉุฑุฏู ุงุณฺฉุฑูพุช ุจู ุนููุงู ฺฉ ูุฑุขูุฏ ุฌุฏุงฺฏุงูู
    # check=True ุจุงุนุซ ูโุดูุฏ ฺฉู ุงฺฏุฑ ุงุณฺฉุฑูพุช ุจุง ุฎุทุง ููุงุฌู ุดูุฏุ ฺฉู ูุฑุขูุฏ ูุชููู ฺฏุฑุฏุฏ
    result = subprocess.run([python_executable, script_name], check=True)
    
    if result.returncode == 0:
        print(f"\nโ ุงุณฺฉุฑูพุช '{script_name}' ุจุง ููููุช ุงุฌุฑุง ุดุฏ.")
        return True
    else:
        # ุงู ุจุฎุด ุจู ุฏูู check=True ูุนูููุงู ุงุฌุฑุง ููโุดูุฏุ ุงูุง ุจุฑุง ุงุทููุงู ุจุดุชุฑ ูุฑุงุฑ ุฏุงุฏู ุดุฏู
        print(f"\nโ ุงุณฺฉุฑูพุช '{script_name}' ุจุง ุฎุทุง ุจู ูพุงุงู ุฑุณุฏ (ฺฉุฏ ุฎุทุง: {result.returncode}).")
        return False

def main():
    """ุงุฌุฑุง ุชูุงู ุงุณฺฉุฑูพุชโูุง ุจู ุชุฑุชุจ."""
    for script in SCRIPTS_IN_ORDER:
        try:
            if not run_script(script):
                break # ุฏุฑ ุตูุฑุช ุจุฑูุฒ ุฎุทุงุ ุงุฒ ุญููู ุฎุงุฑุฌ ุดู
        except subprocess.CalledProcessError:
            print(f"\nโโโ ุฎุทุง ุจุญุฑุงู ุฏุฑ ุงุฌุฑุง '{script}'. ูุฑุขูุฏ ุจูโุฑูุฒุฑุณุงู ูุชููู ุดุฏ.")
            break
        except KeyboardInterrupt:
            print("\n๐ ูุฑุขูุฏ ุชูุณุท ฺฉุงุฑุจุฑ ูุชููู ุดุฏ.")
            break

if __name__ == "__main__":
    main()